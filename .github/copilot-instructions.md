## Инструкции для ИИ-агентов (мебель-ИИ)

Краткое руководство, чтобы сразу быть продуктивным в этом репо. Основано на документах: `.qoder/rules/important.md`, `.qoder/quests/unknown-task.md`, `дизайн.md`, `описание.md`, `RDP.md`.

### ВАЖНО — always-on правила
- Всегда используй поиск интернете для получения свежей информации для 2025 года, о версиях, интеграциях, библиотеках, стеках, апи документации и тд.
- Всегда думай, общайся, отвечай на русском языке.
- Всегда используй вопросы и размышление для получения информации.
- Всегда спрашивай если нужны какие нибудь детали или выбор.
- Всегда после редактирования файлов отмечай выполнениене задачи в `План задач.md`
- Не забывай что мы делаем стабильное MVP, для пилота.

### Big picture (что мы строим)
- Облачный AI‑SaaS для мебельных фабрик: от ТЗ/эскиза → параметры → подбор фурнитуры (RAG) → BOM → DXF/G‑code → ZIP → выгрузка в 1С.
- Архитектура (см. unknown-task.md §2): Backend FastAPI (Python 3.12), Frontend Next.js 15.5/React 19, AI: YandexGPT 5.1 Pro + Vision OCR + Embeddings; RAG: YDB Vector Search; CAD/CAM: FreeCAD 1.0.x + ezdxf 1.4.2; Данные: PostgreSQL 16, Redis 7.2, Yandex Object Storage; Интеграция: 1С (OData/HTTP).

### Ключевые доменные сущности (см. unknown-task.md §3)
- Order, ProductConfig, Panel, BOM, HardwareItem, Supplier, DXFJob, GCodeJob, Artifact, AuditLog, Validation(+ValidationItem).
- Единицы измерения — миллиметры (мм). Все параметры и проверки в мм.

### Важные процессы и контракты
- API v1 (см. unknown-task.md §4):
  - POST `/api/v1/spec/extract` → извлечение параметров из текста/эскиза/OCR.
  - POST `/api/v1/hardware/select` → RAG‑подбор фурнитуры (YDB k‑NN → YandexGPT ранжирование).
  - POST `/api/v1/cam/dxf`, `/api/v1/cam/gcode` → асинхронные CAM‑задачи (статусы: Created → Processing → Completed/Failed).
  - POST `/api/v1/spec/validate`, `/api/v1/validation/approve` → интерактивная проверка параметров технологом (гейт перед следующими шагами).
  - POST `/api/v1/integrations/1c/export` → выгрузка заказа в 1С.

### Конвенции проекта и ограничения
- Безопасность/аудит (unknown-task.md §8, §9):
  - Не передавать ПДн в промпты; хранить и логировать без ПДн; Presigned URL с TTL ≤ 15 мин; логировать источники RAG.
  - Роли: администратор, технолог, дизайнер.
- Техстек фиксирован для MVP (см. RDP.md): не менять версии без явного запроса; ИИ‑вызовы только через Yandex Cloud/GigaChat; без локальных LLM/GPU.
- Язык интерфейса/доков — русский; параметры — в мм; страницы фронта включают wizard из 4 шагов (см. дизайн.md).

### Типовые Dev‑задачи (паттерны выполнения)
- Backend: проектируй Pydantic‑схемы под сущности выше; соблюдай REST‑контракты; CAM‑задачи делай асинхронными (очередь в Redis, статусы как в §7).
- RAG: импортируй каталоги фурнитуры (CSV/XLSX/JSON) → нормализация → эмбеддинги (Yandex Embeddings) → коллекция в YDB Vector → k‑NN + фильтры → ранжирование в YandexGPT.
- Интерактивная валидация: после `spec/extract` и `hardware/select` запрашивай подтверждения (Validation/ValidationItem) и блокируй переход до approve.
- CAD/CAM: DXF через ezdxf; G‑code через FreeCAD Path (GRBL постпроцессор); финальный ZIP с DXF/NC/BOM/отчетами.

### Качество и метрики (MVP)
- Golden set тесты (≥20–30 кейсов) для полного конвейера; P95 `/spec/extract` ≤ 5 с; CAM — асинхрон.
- Проверки CAM: размеры в мм, радиусы, оффсеты; аудит источников RAG и промптов (без ПДн).

### Где смотреть примеры и подробности
- Структура и пайплайны, контракты и диаграммы: `.qoder/quests/unknown-task.md` (§2–7, 10–11, 14, 16, 18).
- UI‑паттерны, шаги wizard, bento‑grid: `дизайн.md`.
- Цели/контекст MVP и ценность: `описание.md`.
- Зафиксированные версии и запреты для стека: `RDP.md`.
- Always‑on правила для агентов: `.qoder/rules/important.md` (искать свежие версии/интеграции, отвечать по‑русски, задавать уточнения при нехватке данных).

### Do / Don’t
- Do: следуй API‑контрактам и доменной модели; храни файлы в Object Storage через presigned URL; логируй без ПДн; соблюдай русскоязычные комментарии/докстроки.
- Don’t: не менять версии стеков и не подключать внешние LLM/облака; не смешивать единицы измерения; не пропускать этапы интерактивной валидации.

Если кодовых модулей нет (только доки): начинай с моно‑репо каркаса (`api/`, `web/`, `integrations/`, `cad-cam/`, `shared/`, `tests/`, `docs/`) и минимальных заглушек под указанные эндпоинты и пайплайны.
